# 2025.01.20 TIL
### SQL 중급(서브쿼리, 집합 연산자, 순위 함수)
서브쿼리, 집합 연산자, 순위 함수에 대해서 배우고 쿼리를 작성하는 시간을 가졌습니다.
순위 함수의 경우 다음 시간에 윈도우 함수를 추가적으로 다 배우게 되면 실습을 거치면서 더 익숙해 질 것 같습니다.

서브쿼리, 집합 연산자의 깊은 이해를 위해 강사님께서 어려운 5개의 문제를 내줬고 고민하는 과정에서 꽤 익숙해질 수 있었던 것 같습니다.
아래에 오늘 작성한 문제들의 쿼리 첨부합니다.
```MYSQL
-- 1.
select d.department_name, e.job_id, round(avg(salary),2), max(salary) from employees e
left outer join departments d
on d.department_id = e.department_id
group by d.department_name, e.job_id
having avg(salary) >= 8000
order by avg(salary) desc;

select (select department_name from departments where department_id = e.department_id), e.job_id
, round(avg(salary),2), max(salary) 
from employees e
group by department_id, e.job_id
having avg(salary) >= 8000
order by avg(salary) desc;

-- 2.
select d.department_name, ceil(avg(salary)) from employees e
left outer join departments d
on e.department_id = d.department_id
where add_months(sysdate, -60) <= e.hire_date
group by d.department_name
having avg(salary) >= (select avg(salary) from employees);


-- 3.
select c.name, l.amount, l.status from customers c
left outer join loans l
on c.customer_id = l.customer_id
left outer join branches b
on l.branch_id = b.branch_id
where b.location = 'Location 4' and l.amount >= 50000;

select c.name, l.amount, l.status 
from customers c
left outer join loans l
on c.customer_id = l.customer_id
where l.branch_id in (select branch_id from branches where location = 'Location 4') and l.amount >= 50000;


-- 4.
select name, email, phone from customers c
left outer join loans l
on c.customer_id = l.customer_id
where l.status = 'REJECTED'
intersect
select name, email, phone from customers c
left outer join loans l
on c.customer_id = l.customer_id
where l.status = 'PENDING';

-- 5.
select c.name as "고객 이름", a.balance as "금액"
from customers c
left outer join accounts a
on c.customer_id = a.customer_id
where a.balance >= 50000
union all
select c.name as "고객 이름", l.amount as "금액"
from customers c
left outer join loans l
on c.customer_id = l.customer_id
where l.status = 'PENDING'
order by "고객 이름";

```
